<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>css sprites 合并和代码生成工具</title>
	<style>
		html{background:#fff;color:#000;-webkit-text-size-adjust:none;-ms-text-size-adjust:none}
		body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,code,form,fieldset,legend,input,textarea,p,blockquote,th,td,hr,button,article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{padding:0;margin:0}
		table{border-collapse:collapse;border-spacing:0}
		fieldset,img{border:0}
		body,button,input,select,textarea{font: 400 12px/1.8 'microsoft yahei';}
		input,select,img{vertical-align:middle}
		input,select{outline:0}
		input,select,textarea{font-size:100%}
		ul,ol{list-style:none}
		h1,h2,h3,h4,h5,h6{font-size:100%}
		address,cite,dfn,em,var{font-style:normal}
		abbr,acronym{border:0;font-variant:normal}
		fieldset,img{border:0}
		del{text-decoration:line-through}
		address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:500}
		iframe{display:block}
		sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
		sup{top:-.5em}
		sub{bottom:-.25em}
		caption,th{text-align:left}
		th{text-align:inherit}
		.clearfix:after{content:"";height:0;visibility:hidden;display:block;clear:both}
		.clearfix{zoom:1}
		.fl,.fr{display:inline}
		.fl{float:left}
		.fr{float:right}
		ins,a{text-decoration:none}
		a:hover{text-decoration:underline}
		article,aside,details,figcaption,figure,footer,header,hgroup,nav,section,summary{display:block}
		audio,canvas,video{display:inline-block;*display:inline;*zoom:1}
		a{color:#333;text-decoration:none}
		a:hover{text-decoration:underline;color:#f60}
		html{background:#ededed}
		html,body{background: #009872;min-width:1000px;width:100%; height: 100%;}
		
		.sprite_box{background: #fff; width: 800px; height: 800px; position: relative;}
		.dropbox{height: 100%; width: 100%; background: url(plus.png) center center no-repeat rgba(0,0,0,.1); position: absolute; top: 0; left: 0; display: none;}

		.dropbox.ctl-active{display: block;}
		.workplace{}
	</style>
</head>
<body>
	<div class="sprite_box" id="sprite_box">
		<div class="workplace" id="workplace"></div>
		<div class="dropbox" id="dropbox"></div>
	</div>
</body>
</html>
<script src="jquery-1.4.4.min.js"></script>
<script src="ue.easydrag.js"></script>
<script type="text/javascript">

	var FileHelp = (function(){
		var MINETYPES = {
			"image/gif" : "GIF",
			"image/png" : "PNG",
			"image/jpeg" : "JPG"
		};

		return {
			getFileType : (function(){
				
				return function(type){
					return MINETYPES[type];
				}
			})(),

			getMimeType : (function(){
				return function(type){
					type = type.toUpperCase();

					for(var t in MINETYPES){
						if(MINETYPES[t] == type){
							return t;
						}
					}
				}
			})(),

			getFileName : function (allname){
				allname = allname.split(".");
				allname.pop();
				allname.join(".");
				return allname;
			}
		}
	})();

	var Sprites = (function(){

		var sprite_box = document.getElementById("sprite_box"),
			dropbox = document.getElementById("dropbox"),
			workplace = document.getElementById("workplace"),
			sprites = [];

		return {
			init : function(){

				document.addEventListener("dragenter", function(e){  
				    dropbox.classList.add("ctl-active");
				}, false);

				dropbox.addEventListener("dragover", function(e){  
				    e.stopPropagation();  
				    e.preventDefault(); 
				}, false);  

				dropbox.addEventListener("drop", function(e){  
				    e.stopPropagation();  
				    e.preventDefault();
				    dropbox.classList.remove("ctl-active");
				    Sprites.handleFiles(e.dataTransfer.files);  
				}, false);
			},

			handleFiles : function(files){
				var i = 0,
					file = null,
					reader = null;

				for (; i < files.length; i++) {

			        file = files[i];

			  		if (!file.type.match(/image*/)) {  
					    continue;  
					}
					  
					reader = new FileReader();

					reader.onload = (function(file) {

						return function(e) {
							console.log(file);
							Sprites.FileReaderOnload(e, file);
						}; 

					})(file);

					reader.readAsDataURL(file);
			    }  
			},

			FileReaderOnload : function(e, file){
				var img_container = document.createElement("div"),
					img = document.createElement("img"),
					drag_node = null;

				console.log(e.target);

				img.src = e.target.result;  

				img_container.style.width = img.width + "px";
				img_container.style.height = img.height + "px";
				img_container.style.backgroundImage = "url(" + e.target.result + ")";
				img_container.classList.add("img_container");
				img_container.style.position = "absolute";
				
				workplace.appendChild(img_container);

				img_container.addEventListener("mousedown", function(e){
					drag_node = this.cloneNode(true);
					drag_node.setAttribute("draggable", true);
					workplace.appendChild(drag_node);
					this.style.display = "none";

					drag_node.addEventListener("drag", function(e){
						console.log(e, "drag");
					});

					drag_node.addEventListener("dragstart", function(e){
						console.log(e, "dragstart");
					});
				});

				workplace.addEventListener("drop", function(e){
					this.style.left = e.clientX + "px";
					this.style.top = e.clientY + "px";
					workplace.removeChild(drag_node);
				}); 

				sprites.push({img : img, file : file});
			}
		}

	})();

	document.addEventListener("DOMContentLoaded", function(){
		Sprites.init();
	});
</script>